<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Spotify Playlists</title>
  <link rel="stylesheet" href="style/playlists.css" />
</head>
<body>
  <div class="header-bar">
    <a href="javascript:history.back()" class="link back">Back</a>
    <h1 id="title">Spotify Playlists</h1>
    <a href="index.html" class="link home">Home</a>
  </div>
  <div class="playlists" id="playlists"></div>

  <script>
/*
  Note:
  For security purposes, the Spotify Client ID and Client Secret are not included in this repository. 
  Please create your own Spotify Developer account and register an application to obtain these credentials. 
  Make sure to store them securely (e.g., using environment variables or a server-side authentication flow) 
  instead of hardcoding them in the client-side code.
*/

    // Spotify API credentials
    const clientId = "YOUR_CLIENT_ID"; // Replace with your actual Client ID
    const clientSecret = "YOUR_CLIENT_SECRET"; // Replace with your actual Client Secret

    // Get category name from URL query parameters
    const urlParams = new URLSearchParams(window.location.search);
    const categoryName = urlParams.get("categoryName");

    // Set the page title dynamically based on category
    document.getElementById("title").textContent = `${decodeURIComponent(categoryName)} Playlists`;

    // Function to get Spotify access token using Client Credentials
    async function getAccessToken() {
      const response = await fetch("https://accounts.spotify.com/api/token", {
        method: "POST",
        headers: {
          "Content-Type": "application/x-www-form-urlencoded"
        },
        body: `grant_type=client_credentials&client_id=${clientId}&client_secret=${clientSecret}`
      });

      const data = await response.json();
      return data.access_token; // Return the token to use in the next request
    }

    // Fetch playlists based on the selected genre/category
    async function getPlaylists() { 
      const accessToken = await getAccessToken();
      const response = await fetch(`https://api.spotify.com/v1/search?q=genre:${encodeURIComponent(categoryName)}&type=playlist`, {
        headers: {
          Authorization: `Bearer ${accessToken}`
        }
      });

      if (!response.ok) {
        console.error("Failed to fetch playlists:", response.status, response.statusText);
        document.getElementById("playlists").innerHTML = "<p>Unable to load playlists. Please try again later.</p>";
        return;
      }

      const data = await response.json();
      if (!data.playlists || !data.playlists.items) {
        console.error("Unexpected data format:", data);
        document.getElementById("playlists").innerHTML = "<p>No playlists found for this category.</p>";
        return;
      }
      console.log(data.playlists.items);
      displayPlaylists(data.playlists.items);
    }

    // Display playlist on the page
    function displayPlaylists(playlists) {
      const container = document.getElementById("playlists");
      container.innerHTML = "";

      playlists.forEach(playlist => {
        // Skip if any critical data is missing
        if (!playlist || !playlist.name || !playlist.external_urls?.spotify) return;

        const imageUrl = playlist.images[0]?.url || "bg.jpg";
        const div = document.createElement("div");

        div.className = "playlist";
        div.innerHTML = `
          <img src="${imageUrl}" alt="${playlist.name}">
          <p>${playlist.name}</p>
          <button class="track-btn" onclick="window.location.href='tracks.html?playlistId=${playlist.id}'">View Tracks</button>
        `;
        container.appendChild(div);
      });
    }

    getPlaylists();
  </script>
</body>
</html>
